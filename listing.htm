<html>

<head>
 <link rel="stylesheet" href="main.css">
<h2 align="center">Ship Online</h2>
<h2 align="center">
 <a  align="center" href='home.htm'>Home</a> 
 <a  align="center" href='bidding.htm'>Bidding</a> 
 <a  align="center" href='maintenance.htm'>Maintenance</a> 
<a  align="center" href='logout.php'>LogOut</a> </h2 >
 </head>


<body>


	<div class="container">
	 
		<form class="form-style-5" name="list" onsubmit="userRegistration()">
			<legend><span class="number">i</span> Item Details</legend>
		
			<span ></span>
			<label><span>Item Name:</span> <input  type="text" id="iname" name="iname" placeholder="item name" required> </label> <br>
			<label><span>Description:</span> <textarea  id="idescription" name="idescription" placeholder="description" required> </textarea> </label> <br>
			
	<label> <span>Category :</span><select name="category" id="category" onchange="if (this.value=='other'){this.form['other'].style.visibility='visible'}else {this.form['other'].style.visibility='hidden'};">
	<option value="" selected="selected">Select...</option>
	<option  value="other">Other</option>
	</select><span class="span1">Choose from list or select other for new category</span><br> <input id="other" type="text" name="other" style="visibility:hidden;"/> </label>
			<label><span>start price : </span><br> <input type="number"  name="dStartPrice" id="dStartPrice"  value = "0" required><input type="number" name="cStartPrice" id="cStartPrice"  value = "00" required></label>
			<label><span>reserve price :</span><br> <input type="number" name="dReservePrice" id="dReservePrice"  value = "0" required><input type="number" name="cReservePrice" id="cReservePrice"  value = "00" required></label>
			<label><span>Buy It Now Price :</span><br> <input type="number"  name="dBuyPrice" id="dBuyPrice"  value = "0" required><input type="number" name="cBuyPrice" id="cBuyPrice"  value = "00" required></label>
			<label>Duration  <select style ="margin-left: 3px " name='durationDay' id='durationDay' >
				<option value ="-1">Day</option>
				<option value="1">1</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5</option>
				<option value="6">6</option>
				<option value="7">7</option>
				<option value="8">8</option>
				<option value="9">9</option>
				<option value="10">10</option>
				<option value="11">11</option>
				<option value="12">12</option>
				<option value="13">13</option>
				<option value="14">14</option>
				<option value="15">15</option>
				<option value="16">16</option>
				<option value="17">17</option>
				<option value="18">18</option>
				<option value="19">19</option>
				<option value="20">20</option>
				<option value="21">21</option>
				<option value="22">22</option>
				<option value="23">23</option>
				<option value="24">24</option>
				<option value="25">25</option>
				<option value="26">26</option>
				<option value="27">27</option>
				<option value="28">28</option>
				<option value="29">29</option>
				<option value="30">30</option>
				<option value="31">31</option>
			</select>
			<select style ="margin-left: 3px " name='durationHour' id='durationHour' >
				<option value ="-1">Hour</option>
				<option value="0">00</option>
				<option value="1">01</option>
				<option value="2">02</option>
				<option value="3">03</option>
				<option value="4">04</option>
				<option value="5">05</option>
				<option value="6">06</option>
				<option value="7">07</option>
				<option value="8">08</option>
				<option value="9">09</option>
				<option value="10">10</option>
				<option value="11">11</option>
				<option value="12">12</option>
				<option value="13">13</option>
				<option value="14">14</option>
				<option value="15">15</option>
				<option value="16">16</option>
				<option value="17">17</option>
				<option value="18">18</option>
				<option value="19">19</option>
				<option value="20">20</option>
				<option value="21">21</option>
				<option value="22">22</option>
				<option value="23">23</option>
			
			</select>
			
			<select style ="margin-left: 3px " name='durationMin' id='durationMin' >
				<option value ="-1">Min</option>
				<option value="0">00</option>
				<option value="1">01</option>
				<option value="2">02</option>
				<option value="3">03</option>
				<option value="4">04</option>
				<option value="5">05</option>
				<option value="6">06</option>
				<option value="7">07</option>
				<option value="8">08</option>
				<option value="9">09</option>
				<option value="10">10</option>
				<option value="11">11</option>
				<option value="12">12</option>
				<option value="13">13</option>
				<option value="14">14</option>
				<option value="15">15</option>
				<option value="16">16</option>
				<option value="17">17</option>
				<option value="18">18</option>
				<option value="19">19</option>
				<option value="20">20</option>
				<option value="21">21</option>
				<option value="22">22</option>
				<option value="23">23</option>
				<option value="24">24</option>
				<option value="25">25</option>
				<option value="26">26</option>
				<option value="27">27</option>
				<option value="28">28</option>
				<option value="29">29</option>
				<option value="30">30</option>
				<option value="11">31</option>
				<option value="12">32</option>
				<option value="13">33</option>
				<option value="14">34</option>
				<option value="15">35</option>
				<option value="16">36</option>
				<option value="17">37</option>
				<option value="18">38</option>
				<option value="19">39</option>
				<option value="20">40</option>
				<option value="21">41</option>
				<option value="22">42</option>
				<option value="23">43</option>
				<option value="24">44</option>
				<option value="25">45</option>
				<option value="26">46</option>
				<option value="27">47</option>
				<option value="28">48</option>
				<option value="29">49</option>
				<option value="30">50</option>
				<option value="21">51</option>
				<option value="22">52</option>
				<option value="23">53</option>
				<option value="24">54</option>
				<option value="25">55</option>
				<option value="26">56</option>
				<option value="27">57</option>
				<option value="28">58</option>
				<option value="29">59</option>
				<option value="30">60</option>
				
			</select>
			
			
</label>
	        <button  type="submit" onclick="validateDate()" >Add</button>
			<button type="reset" value="Reset">Reset</button>
		</form>

		</div>
<b id="error" > </b >

</body>


</html>



<!-- Javascript -->
<script>
//    event.preventDefault();

// populate dropdown 


// check session 

document.onload = checkSession() ; 

function checkSession()
{
	var xHRObject1 = false;
	if (window.XMLHttpRequest)
	{
		xHRObject1 = new XMLHttpRequest();
	}
	else if (window.ActiveXObject)
	{
		xHRObject1 = new ActiveXObject("Microsoft.XMLHTTP");
	}




    xHRObject1.open("GET", "checksession.php?check=session", true);
    xHRObject1.onreadystatechange = getSession;
function getSession(){
    if ((xHRObject1.readyState == 4) &&(xHRObject1.status == 200))
    {
        var serverResponse1 = xHRObject1.responseText;
	
        if(serverResponse1.trim() == "unavailable"){
			alert("You are not logged in ");    
			location = "login.htm"
        } 
		else{
		
		//getRows();
		 fillDropdown();
		
		}
    }
}-
    xHRObject1.send(null);
	
	
}

//dropdown
function fillDropdown()
{


	var xHRObject2 = false;
	if (window.XMLHttpRequest)
	{
		xHRObject2 = new XMLHttpRequest();
	}
	else if (window.ActiveXObject)
	{
		xHRObject2 = new ActiveXObject("Microsoft.XMLHTTP");
	}


    xHRObject2.open("GET", "dropdown.php", true);
    xHRObject2.onreadystatechange = getlist;

function getlist(){
    if ((xHRObject2.readyState == 4) &&(xHRObject2.status == 200))
    {
		
		var spantag =  xHRObject2.responseText;
	
		if(spantag.trim() != "none" && spantag != "")
		{
	
			var split = spantag.split(",");
			for(a in split)
			{
				addOption(document.list.category, split[a], split[a]);

			}
		}
    }
}-
    xHRObject2.send(null);
	




}

function addOption(selectbox,text,value )
{
	var optn = document.createElement("OPTION");
	optn.text = text;
	optn.value = value;
	selectbox.options.add(optn);
}

// function to validate date requirements 
function validateDate(){
//    event.preventDefault();
	var dDay = document.getElementById("durationDay") 
	, dHour = document.getElementById("durationHour")
	, dMin = document.getElementById("durationMin"),
	category = document.getElementById("category"),
	other = document.getElementById("other"),
	startPrice = document.getElementById("dStartPrice"),
	reservePrice = document.getElementById("dReservePrice"),
	buyPrice = document.getElementById("dBuyPrice")	;
	if((category.value == "other" && other.value == "") || category.value == "")
	{

		category.setCustomValidity("select category or other and enter in text box");
		dDay.setCustomValidity('') ;
		startPrice.setCustomValidity('') ;
		reservePrice.setCustomValidity('') ;
		buyPrice.setCustomValidity('') ;

	}
	else if((dDay.value == -1 && dHour.value == -1 && dMin.value == -1) || ((dDay.value == -1 && (dHour.value == -1 || dHour.value == 0) && (dMin.value == -1 || dMin.value == 0))))
	{


		dDay.setCustomValidity("select duration , it must be greater than 0") ;
		category.setCustomValidity('');
		startPrice.setCustomValidity('') ;
		reservePrice.setCustomValidity('') ;
		buyPrice.setCustomValidity('') ;		
	}
	else if (startPrice.value < 1)
	{
		category.setCustomValidity('');
		dDay.setCustomValidity('') ;
		reservePrice.setCustomValidity('') ;
		buyPrice.setCustomValidity('') ;

		startPrice.setCustomValidity("make Start price to atleast 1 ");
	
	}
	else if ((reservePrice.value - 1) < (startPrice.value -1 ) || (reservePrice.value) < startPrice.value )
	{
		category.setCustomValidity('');
		dDay.setCustomValidity('') ;
		startPrice.setCustomValidity('') ;
		buyPrice.setCustomValidity('') ;
		reservePrice.setCustomValidity('');
		reservePrice.setCustomValidity(" reserve price should not be less than start price (diff of dollars) ");
	
	}
	else if (buyPrice.value <= reservePrice.value)
	{
		category.setCustomValidity('');
		dDay.setCustomValidity('') ;
		buyPrice.setCustomValidity('') ;
		startPrice.setCustomValidity('') ;
		reservePrice.setCustomValidity('');
		reservePrice.setCustomValidity(" reserve price must be less than buy price (diff of dollars) ");
	
	}
	else if (reservePrice.value < 1)
	{
		category.setCustomValidity('');
		dDay.setCustomValidity('') ;
		startPrice.setCustomValidity('') ;
		buyPrice.setCustomValidity('') ;
		reservePrice.setCustomValidity("make reserve price to  atleast 1 ");
	
	}
	else if (buyPrice.value < 1)
	{
		category.setCustomValidity('');
		dDay.setCustomValidity('') ;
		startPrice.setCustomValidity('') ;
		reservePrice.setCustomValidity('') ;
		buyPrice.setCustomValidity("make buy price to atleast 1 ");
	
	}
	else{
			category.setCustomValidity('');
		dDay.setCustomValidity('') ;
		startPrice.setCustomValidity('') ;
		buyPrice.setCustomValidity('') ;

			reservePrice.setCustomValidity('');

	}
}







 var xHRObject = false;
if (window.XMLHttpRequest)
{
    xHRObject = new XMLHttpRequest();
}
else if (window.ActiveXObject)
{
    xHRObject = new ActiveXObject("Microsoft.XMLHTTP");
}

function userRegistration(){

    event.preventDefault();
    var item = document.getElementById('iname').value;
    var description = document.getElementById('idescription').value;
	var startPrice1 = document.getElementById('dStartPrice').value +"."+ document.getElementById('cStartPrice').value ; 
	var reservePrice1 = document.getElementById('dReservePrice').value +"."+ document.getElementById('cReservePrice').value ; 
	var buyPrice1 = document.getElementById('dBuyPrice').value +"."+ document.getElementById('cBuyPrice').value ; 
	var day = document.getElementById('durationDay').value ;
	var hour = document.getElementById('durationHour').value ;
	var Min = document.getElementById('durationMin').value ; 
	
	if(day == -1)
	{
		day = 0 ;
	}
	if(hour == -1)
	{
		hour = 00 
	}
	if(Min == -1)
	{
		Min = 00 ;
	}
	if((category.value == "other" ))
	{
		var category1 = document.getElementById('other').value; 
	}
	else
	{
		var category1 = document.getElementById('category').value ;
	}
    var duration = (((day*24*60 ) + (hour * 60 )) *60) + (Min*60);
	xHRObject.open("GET", "listinghelper.php?itemname=" + encodeURIComponent(item) + "&description=" + encodeURIComponent(description) + "&category=" + encodeURIComponent(category1)+ "&startPrice=" + encodeURIComponent(startPrice1)+ "&reservePrice=" + encodeURIComponent(reservePrice1)+ "&buyPrice=" + encodeURIComponent(buyPrice1)+ "&duration=" + encodeURIComponent(duration), true);
	xHRObject.onreadystatechange = getData;
   	 
	xHRObject.send(null); 
}

function getData(){

    if ((xHRObject.readyState == 4) &&(xHRObject.status == 200))
    {
        var serverResponse = xHRObject.responseText;
	
        if(serverResponse.trim() == "OK"){
	
        }
		else {
		document.list.category.options.length = 2 ;
		fillDropdown();
		document.getElementById("error").innerHTML = serverResponse;
		
        }
    }
}
function done (){
	location = bidding.htm ; 
}
  
</script>
